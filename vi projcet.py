import pandas as pd
import json
import ast # json.loads ì‹¤íŒ¨ ì‹œ ë¬¸ìì—´ ë”•ì…”ë„ˆë¦¬ë¥¼ íŒŒì‹±í•˜ê¸° ìœ„í•¨

# --- 0ë‹¨ê³„: ëª¨ë“  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (íŒŒì¼ ê²½ë¡œ í™•ì¸) ---
# ë„¤ê°€ ì €ì¥í•œ .csv íŒŒì¼ë“¤ì˜ ì •í™•í•œ ê²½ë¡œì™€ íŒŒì¼ëª…ì„ ì…ë ¥
# ì˜ˆì‹œ: 'C:/PythonProject/TFT_Challenger_MatchData.csv'
file_path_match = 'TFT_Challenger_MatchData.csv'
file_path_item = 'TFT_Item_CurrentVersion.csv'
file_path_champion_info = 'TFT_Champion_CurrentVersion.csv' # ì´ íŒŒì¼ë„ '.csv'ê² ì§€


try:
    df_match = pd.read_csv(file_path_match)
    df_item = pd.read_csv(file_path_item)
    df_champion_info = pd.read_csv(file_path_champion_info)
    print("âœ… ëª¨ë“  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ!")
except FileNotFoundError as e:
    print(f"âŒ ì˜¤ë¥˜: íŒŒì¼ '{e.filename}'ì„(ë¥¼) ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ ê²½ë¡œì™€ ì´ë¦„ì„ ë‹¤ì‹œ í™•ì¸í•´ë¼!")
    exit() # íŒŒì¼ ì—†ìœ¼ë©´ ë” ì§„í–‰í•  í•„ìš” ì—†ìŒ
except Exception as e:
    print(f"âŒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ: {e}")
    exit()


#    - ë¬¸ì œ ì •ì˜: ì›ë³¸ ë°ì´í„°ì˜ `players` ì»¬ëŸ¼ì€ JSON ë¬¸ìì—´ ë˜ëŠ” íŒŒì´ì¬ ë¦¬ìŠ¤íŠ¸/ë”•ì…”ë„ˆë¦¬ í˜•íƒœì˜ ë¬¸ìì—´ë¡œ,
#                 ë‹¤ì–‘í•œ í”Œë ˆì´ì–´ì™€ ê·¸ë“¤ì´ ë³´ìœ í•œ ìœ ë‹›(ì±”í”¼ì–¸) ì •ë³´ë¥¼ ì¤‘ì²©ëœ í˜•íƒœë¡œ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
#    - í•´ê²° ëª©í‘œ: ì´ ë³µì¡í•œ êµ¬ì¡°ì—ì„œ ê° ê²Œì„ì— ì‚¬ìš©ëœ ëª¨ë“  ì±”í”¼ì–¸ì˜ `character_id`(ì´ë¦„)ë§Œì„ ì•ˆì „í•˜ê²Œ ì¶”ì¶œí•©ë‹ˆë‹¤.
# ----------------------------------------------------------------------------------------------------
# --- ì±”í”¼ì–¸ ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ëŠ” í•¨ìˆ˜ ì •ì˜ (gameId í¬í•¨ ìµœì¢… í´ë¦° ë²„ì „) ---
def parse_champions_from_match_data(row: pd.Series) -> list:
    champions_extracted = []

    if 'champion' not in row or not row['champion']:
        return []

    # ë°ì´í„°ë¥¼ ë¬¸ìì—´ì—ì„œ Python ê°ì²´ë¡œ íŒŒì‹± ì‹œë„
    parsed_champion_data = None
    try:
        parsed_champion_data = json.loads(row['champion'])
    except (json.JSONDecodeError, TypeError):
        try:
            parsed_champion_data = ast.literal_eval(row['champion'])
        except (ValueError, SyntaxError, TypeError):
            return []

    if not isinstance(parsed_champion_data, dict):
        return []

    # â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼ ì—¬ê¸°ê°€ í•µì‹¬ ìˆ˜ì • ë¶€ë¶„! â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
    # í˜„ì¬ rowì—ì„œ gameIdë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
    # ì´ gameIdëŠ” df_match DataFrameì˜ ê° í–‰ì—ì„œ ë„˜ì–´ì˜¨ ê²ƒì´ë¯€ë¡œ ë°˜ë“œì‹œ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤.
    current_game_id = row['gameId']

    # íŒŒì‹±ëœ ë°ì´í„°(parsed_champion_data)ì˜ í‚¤ë“¤(ì±”í”¼ì–¸ ì´ë¦„)ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
    for champion_name in parsed_champion_data.keys():
        # ì¶”ì¶œëœ ì±”í”¼ì–¸ ì´ë¦„ì„ {'champion': 'ì±”í”¼ì–¸ì´ë¦„'} í˜•íƒœë¡œ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•©ë‹ˆë‹¤.
        # ì—¬ê¸°ì— í•´ë‹¹ ì±”í”¼ì–¸ì´ ì†í•œ ê²Œì„ì˜ 'gameId'ë„ í•¨ê»˜ ì¶”ê°€í•©ë‹ˆë‹¤!
        champions_extracted.append({'champion': champion_name, 'gameId': current_game_id})
        # â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    return champions_extracted


def parse_vi_items(row: pd.Series) -> list:
    """
    DataFrameì˜ ë‹¨ì¼ í–‰ì—ì„œ 'VI' ì±”í”¼ì–¸ì˜ ì•„ì´í…œ IDë¥¼ ì¶”ì¶œí•˜ì—¬ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
    'champion' ì»¬ëŸ¼ì€ {'ì±”í”¼ì–¸ì´ë¦„': {'items': [...], 'star': ...}} í˜•íƒœì˜ ë¬¸ìì—´ë¡œ ê°€ì •í•©ë‹ˆë‹¤.
    Args:
        row (pd.Series): DataFrameì˜ ë‹¨ì¼ í–‰ ë°ì´í„°. 'champion' ë° 'gameId' í‚¤ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
    Returns:
        list: í•´ë‹¹ í–‰ì˜ 'VI' ì±”í”¼ì–¸ì´ ì¥ì°©í•œ ì•„ì´í…œ IDì™€ gameIdë¥¼ í¬í•¨í•˜ëŠ” ë”•ì…”ë„ˆë¦¬ ë¦¬ìŠ¤íŠ¸
              (ì˜ˆ: [{'gameId': 'game_abc', 'vi_item_id': 27}])
              'VI' ì±”í”¼ì–¸ì´ ì—†ê±°ë‚˜ ì•„ì´í…œ ì •ë³´ ì—†ìŒ ì‹œ ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    """
    vi_items_in_row = []
    TARGET_CHAMPION_NAME = 'VI'  # ì°¾ì„ ì±”í”¼ì–¸ ì´ë¦„

    if 'champion' not in row or not row['champion']:
        return []
    if 'gameId' not in row:
        return []
    current_game_id = row['gameId']

    parsed_champion_data = None
    try:
        parsed_champion_data = json.loads(row['champion'])
    except (json.JSONDecodeError, TypeError):
        try:
            parsed_champion_data = ast.literal_eval(row['champion'])
        except (ValueError, SyntaxError, TypeError):
            return []

    if not isinstance(parsed_champion_data, dict):
        return []

    found_vi_in_this_game = False
    vi_original_name = None

    for champ_key in parsed_champion_data.keys():
        if champ_key.upper() == TARGET_CHAMPION_NAME:
            found_vi_in_this_game = True
            vi_original_name = champ_key
            break

    if found_vi_in_this_game:
        vi_champion_detail = parsed_champion_data[vi_original_name]
        if 'items' in vi_champion_detail and isinstance(vi_champion_detail['items'], list):
            for item_id in vi_champion_detail['items']:
                vi_items_in_row.append({'gameId': current_game_id, 'vi_item_id': item_id})

    return vi_items_in_row


# â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²
# 2. DataFrameì— íŒŒì‹± í•¨ìˆ˜ ì ìš© ë° df_champions_exploded ìƒì„±
#    df_match DataFrameì´ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

# df_match ì˜ˆì‹œ (ì‹¤ì œ ë°ì´í„° ë¡œë“œ ì½”ë“œ í•„ìš”)
# df_match = pd.read_csv('your_tft_data.csv')


# ëª¨ë“  ë§¤ì¹˜ì— ëŒ€í•´ ì±”í”¼ì–¸ íŒŒì‹± í•¨ìˆ˜ ì ìš©
# ê²°ê³¼ëŠ” ê° í–‰ì— ì±”í”¼ì–¸ ë”•ì…”ë„ˆë¦¬ ë¦¬ìŠ¤íŠ¸ë¥¼ ë‹´ì€ Series í˜•íƒœê°€ ë©ë‹ˆë‹¤.
all_champions_parsed_series = df_match.apply(parse_champions_from_match_data, axis=1)

flattened_champions_dicts = []
for champion_list_in_row in all_champions_parsed_series.tolist():
    if champion_list_in_row:
        flattened_champions_dicts.extend(champion_list_in_row)

# 3) í‰íƒ„í™”ëœ ë°ì´í„°ë¡œ df_champions_explodedë¥¼ ë§Œë“­ë‹ˆë‹¤.
if flattened_champions_dicts:
    df_champions_exploded = pd.DataFrame(flattened_champions_dicts)

# 4) ê·¸ë¦¬ê³  df_champions_explodedë¥¼ ê°€ì§€ê³  í•„ìš”í•œ ë‹¤ìŒ ì‘ì—…ì„ ì´ì–´ê°€ëŠ” ê²ë‹ˆë‹¤.
if 'champion' in df_champions_exploded.columns:
    df_champions_exploded['champion'] = df_champions_exploded['champion'].str.upper()

# ì´ì–´ì„œ --- 3. 'VI' ì±”í”¼ì–¸ì˜ ì•„ì´í…œ ì •ë³´ ì¶”ì¶œ ë° DataFrame ìƒì„± (df_vi_items) --- ì´ ì§„í–‰ë˜ëŠ” ê±°ì–ì•„!

# Seriesì˜ ë¦¬ìŠ¤íŠ¸ë“¤ì„ í•˜ë‚˜ì˜ í‰í‰í•œ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜ (Flattening)
# ì´ ê³¼ì •ì—ì„œ ë¹ˆ ë¦¬ìŠ¤íŠ¸ëŠ” ì œì™¸í•©ë‹ˆë‹¤.
flattened_champions_list = []
for sublist in all_champions_parsed_series.tolist(): # <-- í•¨ìˆ˜ë¥¼ ì ìš©í•œ ê²°ê³¼ ë³€ìˆ˜ ì´ë¦„ê³¼ í†µì¼!
    if sublist:
        flattened_champions_list.extend(sublist)

# í‰íƒ„í™”ëœ ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ DataFrame ìƒì„±
# ë§Œì•½ flattened_champions_listê°€ ë¹„ì–´ìˆë‹¤ë©´ ë¹ˆ DataFrameì„ ìƒì„±í•˜ì—¬ NameError ë°©ì§€
if flattened_champions_list:
    df_champions_exploded = pd.DataFrame(flattened_champions_list)
else:
    print("ê²½ê³ : íŒŒì‹±ëœ ì±”í”¼ì–¸ ë°ì´í„°ê°€ ì—†ì–´ 'df_champions_exploded'ê°€ ë¹ˆ DataFrameìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.")
    df_champions_exploded = pd.DataFrame(columns=['champion']) # ìµœì†Œí•œì˜ ì»¬ëŸ¼ì€ ì •ì˜




# ----------------------------------------------------------------------------------------------------
# 4. [ë°ì´í„° ì •ì œ] ì±”í”¼ì–¸ ì´ë¦„ í†µì¼ (ëŒ€ì†Œë¬¸ì ì¼ì¹˜)
#    - ë¬¸ì œ ì •ì˜: `df_champions_exploded`ì˜ `champion_name`ê³¼ `df_champion_info`ì˜ `name` ì»¬ëŸ¼ì—
#                 ë™ì¼ ì±”í”¼ì–¸ì´ë¼ë„ ëŒ€ì†Œë¬¸ì í‘œê¸°(ì˜ˆ: 'Vi' vs 'vi')ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
#                 ì´ëŠ” `pd.merge()` ì‹œ ë°ì´í„° ë¶ˆì¼ì¹˜(KeyError ë˜ëŠ” ëˆ„ë½)ë¡œ ì´ì–´ì ¸ ë¶„ì„ ì˜¤ë¥˜ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤.
#    - í•´ê²° ëª©í‘œ: ë‘ ë°ì´í„°í”„ë ˆì„ì˜ ëª¨ë“  ì±”í”¼ì–¸ ì´ë¦„ì„ ì¼ê´€ëœ í˜•íƒœ(ì—¬ê¸°ì„œëŠ” ëŒ€ë¬¸ì)ë¡œ í†µì¼í•˜ì—¬,
#                 ì´í›„ ë°ì´í„° ë³‘í•© ë° ë¶„ì„ì˜ ì •í™•ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤.
# ----------------------------------------------------------------------------------------------------
df_champions_exploded['champion'] = df_champions_exploded['champion'].str.upper()  # ëª¨ë“  ì±”í”¼ì–¸ ì´ë¦„ì„ ëŒ€ë¬¸ìë¡œ ë³€í™˜
df_champion_info['name'] = df_champion_info['name'].str.upper()  # ì±”í”¼ì–¸ ì •ë³´ ë°ì´í„°ì˜ ì´ë¦„ë„ ëŒ€ë¬¸ìë¡œ ë³€í™˜
print("âœ… ë‘ ë°ì´í„°í”„ë ˆì„(`df_champions_exploded`, `df_champion_info`)ì˜ ì±”í”¼ì–¸ ì´ë¦„ì´ ëª¨ë‘ ëŒ€ë¬¸ìë¡œ í†µì¼ë˜ì—ˆìŠµë‹ˆë‹¤.")
print("    - ì´ì œ `pd.merge` ë“± ì±”í”¼ì–¸ ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ëŠ” ëª¨ë“  ì‘ì—…ì—ì„œ ë°ì´í„° ë¶ˆì¼ì¹˜ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤.")

# ----------------------------------------------------------------------------------------------------
# [ë‹¤ìŒ ë‹¨ê³„]
# ì´ì œ df_champions_explodedì™€ df_champion_info, df_item ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬
# ì±”í”¼ì–¸ê³¼ ì•„ì´í…œ ì •ë³´ë¥¼ ë³‘í•©í•˜ê³ , ì›í•˜ëŠ” ë¶„ì„(ì˜ˆ: Vi ì±”í”¼ì–¸ì˜ ë°©ì–´ ì•„ì´í…œ ì°©ìš©ì‹œ ìƒì¡´ ë¶„ì„)ì„ ì§„í–‰í•  ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
# ----------------------------------------------------------------------------------------------------

# ----------------------------------------------------------------------------------------------------
# 5. [í”„ë¡œì íŠ¸ ì „ì œ ê²€ì¦] ì±Œë¦°ì € ê²Œì„ì—ì„œ ê°€ì¥ ë§ì´ ë“±ì¥í•œ ì±”í”¼ì–¸ í™•ì¸ (Viì— ì§‘ì¤‘í•˜ëŠ” í•µì‹¬ ë™ê¸° ì¬í™•ì¸)
#    - [í”„ë¡œì íŠ¸ ëª©í‘œ ì—°ê²°]: Vi ì±”í”¼ì–¸ì˜ ìƒì¡´ ì‹œê°„ ë¶„ì„ì„ ìœ„í•œ 'Vi ì„ íƒ'ì˜ ì •ë‹¹ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤.
#                           Viê°€ ì±Œë¦°ì € íì—ì„œ ì‹¤ì œ ê°€ì¥ ë§ì´ í™œìš©ë˜ëŠ” ì±”í”¼ì–¸ ì¤‘ í•˜ë‚˜ì„ì„ ê²€ì¦í•©ë‹ˆë‹¤.
#    - [í•´ê²° ëª©í‘œ]: `df_champions_exploded` ë°ì´í„°ì—ì„œ ê° ì±”í”¼ì–¸ì˜ ì´ ë“±ì¥ íšŸìˆ˜ë¥¼ ê³„ì‚°í•˜ì—¬ ìˆœìœ„ë¥¼ ë§¤ê¸°ê³ ,
#                 Vi ì±”í”¼ì–¸(`VI`)ì˜ ë“±ì¥ íšŸìˆ˜ì™€ ìˆœìœ„ë¥¼ 'í™•ì‹¤í•˜ê²Œ' ë‹¤ í™•ì¸í•©ë‹ˆë‹¤.
# ----------------------------------------------------------------------------------------------------

print("\n--- âœ… ì±Œë¦°ì € ê²Œì„ ë°ì´í„° ë‚´ ì±”í”¼ì–¸ ë“±ì¥ ë¹ˆë„ TOP 10 ê²€ì¦ ---")

# 'champion_name' ì»¬ëŸ¼(í˜„ì¬ ëª¨ë‘ ëŒ€ë¬¸ì)ì˜ ê° ì±”í”¼ì–¸ ë“±ì¥ íšŸìˆ˜ë¥¼ ê³„ì‚°í•˜ê³  ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.
# ì´ëŠ” íŠ¹ì • ì±”í”¼ì–¸ì´ í•´ë‹¹ ê²Œì„ í™˜ê²½ì—ì„œ ì–¼ë§ˆë‚˜ ì£¼ë ¥ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” í•µì‹¬ ì§€í‘œì…ë‹ˆë‹¤.
most_picked_champions = df_champions_exploded['champion'].value_counts()

# ê°€ì¥ ë§ì´ ë“±ì¥í•œ ìƒìœ„ 10ê°œ ì±”í”¼ì–¸ì„ ì¶œë ¥í•˜ì—¬ ì „ì²´ì ì¸ ì±”í”¼ì–¸ í™œìš© ë¶„í¬ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.
print(most_picked_champions.head(10))

# 'VI' ì±”í”¼ì–¸ì´ ì „ì²´ ìˆœìœ„ì—ì„œ ëª‡ ìœ„ì¸ì§€, ì´ ëª‡ ë²ˆ ë“±ì¥í–ˆëŠ”ì§€ 'ê°•ë ¥í•˜ê²Œ' ì°¾ì•„ ì¦ëª…í•©ë‹ˆë‹¤.
if 'VI' in most_picked_champions.index:  # 'VI'ê°€ ì±”í”¼ì–¸ ëª©ë¡ì— ìˆëŠ”ì§€ ë¨¼ì € í™•ì¸
    vi_count = most_picked_champions['VI']  # 'VI' ì±”í”¼ì–¸ì˜ ì´ ë“±ì¥ íšŸìˆ˜
    # `get_loc()`ì€ í•´ë‹¹ ê°’ì˜ ì¸ë±ìŠ¤(0ë¶€í„° ì‹œì‘)ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ, ì‹¤ì œ ìˆœìœ„ë¥¼ ìœ„í•´ +1ì„ í•©ë‹ˆë‹¤.
    vi_rank = most_picked_champions.index.get_loc('VI') + 1

    print(f"\nğŸ‘‰ 'VI' ì±”í”¼ì–¸ ìˆœìœ„: {vi_rank}ìœ„, ì´ ë“±ì¥ íšŸìˆ˜: {vi_count}íšŒ")
    print("    - ìœ„ ê²°ê³¼ëŠ” 'VI' ì±”í”¼ì–¸ì´ ì±Œë¦°ì € íì—ì„œ ë†’ì€ í™œìš©ë„ë¥¼ ê°€ì§ì„ ë³´ì—¬ì£¼ë©°, ")
    print("    - 'VI' ì±”í”¼ì–¸ì˜ ìƒì¡´ë ¥ ë¶„ì„ì— ì§‘ì¤‘í•˜ëŠ” ë³¸ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ë™ê¸°ë¥¼ ë’·ë°›ì¹¨í•©ë‹ˆë‹¤.")
else:
    print("\nğŸ‘‰ 'VI' ì±”í”¼ì–¸ì€ ê²€ì¦ ëª©ë¡ì— ì—†ìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ ì „ì œ ì¬ê²€í†  í•„ìš”!")

# ----------------------------------------------------------------------------------------------------
# [ë‹¤ìŒ ë‹¨ê³„]
#   - Vi(VI) ì±”í”¼ì–¸ì˜ ë†’ì€ í™œìš©ë„ ì „ì œê°€ ê²€ì¦ë˜ì—ˆìœ¼ë¯€ë¡œ, ì´ì œ ë°ì´í„°ë¥¼ ë³‘í•©í•˜ì—¬
#     Viì˜ ë°©ì–´ ì•„ì´í…œ ì°©ìš© ì—¬ë¶€ì— ë”°ë¥¸ ê²Œì„ ë‚´ 'ìƒì¡´ ì‹œê°„(ingameDuration)' ë¶„ì„ì„ ë³¸ê²©ì ìœ¼ë¡œ ì§„í–‰í•  ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
# ----------------------------------------------------------------------------------------------------
# ----------------------------------------------------------------------------------------------------
# 5. [ë°ì´í„° ìµœì í™”/í•„í„°ë§] ëª¨ë“  ì±”í”¼ì–¸ ì¤‘ 'VI' ì±”í”¼ì–¸ ë°ì´í„°ë§Œ ì´ˆê¸° ë‹¨ê³„ì—ì„œ ë¶„ë¦¬
#    - [í”„ë¡œì íŠ¸ ëª©í‘œ ì—°ê²°]: Vi ì±”í”¼ì–¸ì˜ ìƒì¡´ ì‹œê°„ ë¶„ì„ì´ë¼ëŠ” ëª…í™•í•œ ëª©í‘œì— ë”°ë¼,
#                           ì „ì²´ ë°ì´í„°ë¥¼ ëª¨ë‘ ë³‘í•©í•œ í›„ Vië¥¼ í•„í„°ë§í•˜ëŠ” ëŒ€ì‹ ,
#                           ì´ˆê¸° ë‹¨ê³„ì—ì„œë¶€í„° 'VI' ì±”í”¼ì–¸ ë°ì´í„°ì—ë§Œ ì§‘ì¤‘í•˜ì—¬ ì²˜ë¦¬ íš¨ìœ¨ì„ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤.
#    - [í•´ê²° ëª©í‘œ]: `df_champions_exploded`ì—ì„œ 'VI' ì±”í”¼ì–¸ì— í•´ë‹¹í•˜ëŠ” í–‰ë“¤ë§Œ ì¶”ì¶œí•˜ì—¬,
#                 ì´í›„ì˜ ëª¨ë“  ë³‘í•© ë° ë¶„ì„ ê³¼ì •ì—ì„œ 'VI' ë°ì´í„°ì—ë§Œ ì§‘ì¤‘í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„í•©ë‹ˆë‹¤.
#                 ì´ëŠ” ë¶ˆí•„ìš”í•œ ë°ì´í„° ì²˜ë¦¬ëŸ‰ì„ ì¤„ì—¬ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.
# ----------------------------------------------------------------------------------------------------
print("\n--- âœ… `df_champions_exploded`ì—ì„œ 'VI' ì±”í”¼ì–¸ ë°ì´í„°ë§Œ ì´ˆê¸° í•„í„°ë§ ì‹œì‘ ---")

# 'VI' ì±”í”¼ì–¸ ë°ì´í„°ë§Œ ì¶”ì¶œí•©ë‹ˆë‹¤.
# ì´ë¯¸ 'champion_name' ì»¬ëŸ¼ì´ ëª¨ë‘ ëŒ€ë¬¸ìë¡œ í†µì¼ë˜ì—ˆìœ¼ë¯€ë¡œ 'VI'ë¡œ ì •í™•í•˜ê²Œ í•„í„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
vi_exploded = df_champions_exploded[df_champions_exploded['champion'] == 'VI'].copy()

if vi_exploded.empty:
    print("âŒ ì´ˆê¸° `df_champions_exploded`ì—ì„œ 'VI' ì±”í”¼ì–¸ ë°ì´í„°ë¥¼ 'ì´ˆ ì½”ë”±ì§€ë§Œí¼ë„' ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (í”„ë¡œê·¸ë¨ ì¢…ë£Œ)")
    print("    - ì±”í”¼ì–¸ ì´ë¦„ ëŒ€ë¬¸ì í†µì¼ ê³¼ì • ë˜ëŠ” ì›ë³¸ ë°ì´í„°ì— 'VI' ì±”í”¼ì–¸ ì¡´ì¬ ì—¬ë¶€ë¥¼ ì¬í™•ì¸í•´ ì£¼ì„¸ìš”.")
    exit() # Vi ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´í›„ ë¶„ì„ì„ ì§„í–‰í•  ì´ìœ ê°€ ì—†ìœ¼ë¯€ë¡œ ì¢…ë£Œ

print(f"âœ… 'VI' ì±”í”¼ì–¸ ë°ì´í„° {len(vi_exploded)}ê°œ ì´ˆê¸° í•„í„°ë§ ì™„ë£Œ! (vi_exploded ìƒì„±)")
# print(vi_exploded.head())


# ----------------------------------------------------------------------------------------------------
# 6. [ë°ì´í„° ë³‘í•© 1ë‹¨ê³„] 'VI' ì±”í”¼ì–¸ ë°ì´í„°ì— í•´ë‹¹ ê²Œì„ì˜ ìƒì„¸ ì •ë³´ ì—°ê²°
#    - [í”„ë¡œì íŠ¸ ëª©í‘œ ì—°ê²°]: 'VI' ì±”í”¼ì–¸ì´ ì–´ë–¤ ê²Œì„ì— ì†í–ˆê³ , ê·¸ ê²Œì„ì´ ì–¼ë§ˆë‚˜ ì§€ì†ë˜ì—ˆëŠ”ì§€ë¥¼
#                           ì •í™•íˆ íŒŒì•…í•˜ì—¬ `ingameDuration` ë¶„ì„ì˜ ê¸°ë°˜ì„ ë§ˆë ¨í•©ë‹ˆë‹¤.
#    - [í•´ê²° ëª©í‘œ]: `vi_exploded` (í•„í„°ë§ëœ 'VI' ì±”í”¼ì–¸ ëª©ë¡)ì— `df_match` (ê²Œì„ë³„ ìƒì„¸ ì •ë³´)ì˜
#                 í•µì‹¬ ì»¬ëŸ¼ì„ `gameId`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë³‘í•©í•©ë‹ˆë‹¤.
# ----------------------------------------------------------------------------------------------------
print("\n--- âœ… `vi_exploded`ì— ë§¤ì¹˜ ì •ë³´ ë³‘í•© ì‹œì‘ ---")
# df_matchì—ì„œ í•„ìš”í•œ ì»¬ëŸ¼(gameId, ingameDuration)ë§Œ ì¶”ì¶œí•˜ì—¬ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ì„ ë†’ì…ë‹ˆë‹¤.

df_match_for_merge = df_match[['gameId', 'ingameDuration']].copy()
vi_merged_with_match = pd.merge(
    vi_exploded,                 # ì™¼ìª½ ë°ì´í„°í”„ë ˆì„: 'VI' ì±”í”¼ì–¸ ì •ë³´ (gameId, champion_name)
    df_match_for_merge,          # ì˜¤ë¥¸ìª½ ë°ì´í„°í”„ë ˆì„: ê²Œì„ ìƒì„¸ ì •ë³´ (gameId, ingameDuration)
    on='gameId',                 # ë³‘í•© ê¸°ì¤€ í‚¤: ê²Œì„ ID
    how='left'                   # ì™¼ìª½('VI' ì±”í”¼ì–¸ ëª©ë¡) ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  ì •ë³´ ìœ ì§€
)
print("âœ… 'VI' ì±”í”¼ì–¸ ë°ì´í„°ì— ë§¤ì¹˜ ì •ë³´ ë³‘í•© ì™„ë£Œ! (vi_merged_with_match ìƒì„±)")
# print(vi_merged_with_match.head())


# ----------------------------------------------------------------------------------------------------
# 7. [ë°ì´í„° ë³‘í•© 2ë‹¨ê³„] 'VI' ì±”í”¼ì–¸ ë°ì´í„°ì— ì±”í”¼ì–¸ ìƒì„¸ ì •ë³´ ì—°ê²°
#    - [í”„ë¡œì íŠ¸ ëª©í‘œ ì—°ê²°]: 'VI' ì±”í”¼ì–¸ ìì²´ì˜ ì†ì„±(`cost`, `origin`, `class`)ì„ ì—°ê²°í•˜ì—¬,
#                           Vi ì±”í”¼ì–¸ì˜ íŠ¹ì„±ì„ ì´í•´í•˜ê³  ì¶”í›„ í•„ìš” ì‹œ ì‹¬ì¸µì ì¸ ë¶„ì„ ê¸°ë°˜ì„ ë§ˆë ¨í•©ë‹ˆë‹¤.
#    - [í•´ê²° ëª©í‘œ]: `vi_merged_with_match`ì— `df_champion_info` (ì±”í”¼ì–¸ ìƒì„¸ ì •ë³´)ë¥¼
#                 ì±”í”¼ì–¸ ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ ë³‘í•©í•©ë‹ˆë‹¤.
#                 (ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” `df_item`ê³¼ì˜ ë³‘í•©ì´ ìƒëµë˜ë¯€ë¡œ `suffixes`ë„ í•„ìš” ì—†ìŠµë‹ˆë‹¤.)
# ----------------------------------------------------------------------------------------------------
print("\n--- âœ… `vi_merged_with_match`ì— ì±”í”¼ì–¸ ìƒì„¸ ì •ë³´ ë³‘í•© ì‹œì‘ ---")
# `suffixes`ëŠ” ë‘ DataFrameì— ê°™ì€ ì´ë¦„ì˜ ì»¬ëŸ¼ì´ ìˆì„ ë•Œë§Œ í•„ìš”í•©ë‹ˆë‹¤.
# `vi_merged_with_match`ì—ëŠ” 'champion_name'ë§Œ ìˆê³  'name' ì»¬ëŸ¼ì´ ì—†ìœ¼ë©°,
# `df_champion_info`ì—ëŠ” 'name' ì»¬ëŸ¼ë§Œ ìˆì–´ ì¶©ëŒì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
final_vi_df_no_items = pd.merge(
    vi_merged_with_match,        # ì™¼ìª½ ë°ì´í„°í”„ë ˆì„: 'VI' ì±”í”¼ì–¸, ë§¤ì¹˜ ì •ë³´ (gameId, ingameDuration, champion_name)
    df_champion_info,            # ì˜¤ë¥¸ìª½ ë°ì´í„°í”„ë ˆì„: ì±”í”¼ì–¸ ìƒì„¸ ì •ë³´ (name, cost, origin, class ë“±)
    left_on='champion',     # ì™¼ìª½ í‚¤: ì±”í”¼ì–¸ ì´ë¦„ (í˜„ì¬ ëª¨ë‘ ëŒ€ë¬¸ì 'VI')
    right_on='name',             # ì˜¤ë¥¸ìª½ í‚¤: ì±”í”¼ì–¸ ì •ë³´ì˜ ì´ë¦„ (í˜„ì¬ ëª¨ë‘ ëŒ€ë¬¸ì 'VI')
    how='left'                   # ì™¼ìª½('VI' ì±”í”¼ì–¸) ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  ì •ë³´ ìœ ì§€
)
print("âœ… 'VI' ì±”í”¼ì–¸ë§Œì„ ìœ„í•œ ìµœì¢… ë°ì´í„°í”„ë ˆì„ (ì•„ì´í…œ ì œì™¸) `final_vi_df_no_items` ìƒì„± ì™„ë£Œ!")

# ìµœì¢… ê²°ê³¼ í™•ì¸ (ì˜µì…˜)
# print(final_vi_df_no_items.head())
# print(final_vi_df_no_items.info())

# ----------------------------------------------------------------------------------------------------
# [ìµœì¢… ì¤€ë¹„ ì™„ë£Œ]
#   - ì´ì œ `final_vi_df_no_items`ëŠ” ê° ê²Œì„ì—ì„œ ë“±ì¥í•œ 'VI' ì±”í”¼ì–¸ì— ëŒ€í•œ ê²Œì„ ID, `ingameDuration`,
#     ê·¸ë¦¬ê³  ì±”í”¼ì–¸ ìì²´ì˜ ìƒì„¸ ì •ë³´(`cost`, `origin`, `class` ë“±)ê°€ ëª¨ë‘ í†µí•©ëœ,
#     'VI' ì±”í”¼ì–¸ ìƒì¡´ ë¶„ì„ì— ìµœì í™”ëœ ë°ì´í„°í”„ë ˆì„ì…ë‹ˆë‹¤.
#   - ì´ ë°ì´í„°í”„ë ˆì„ì—ëŠ” í˜„ì¬ ì•„ì´í…œ ì •ë³´ëŠ” í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.
# ----------------------------------------------------------------------------------------------------
# ----------------------------------------------------------------------------------------------------
# 9. [ì•„ì´í…œ ë°ì´í„° ì¶”ì¶œ] ê° ê²Œì„ì—ì„œ 'VI' ì±”í”¼ì–¸ì´ ì¥ì°©í•œ ì•„ì´í…œ ID ì¶”ì¶œ
#    - [í”„ë¡œì íŠ¸ ëª©í‘œ ì—°ê²°]: Viì˜ ìƒì¡´ ì‹œê°„ ë¶„ì„ì—ì„œ 'ë°©ì–´ ì•„ì´í…œ ì°©ìš© ì—¬ë¶€'ë¥¼ íŒë‹¨í•˜ê¸° ìœ„í•´,
#                           Viê°€ ê° ê²Œì„ì—ì„œ ì–´ë–¤ ì•„ì´í…œì„ ì¥ì°©í–ˆëŠ”ì§€ íŒŒì•…í•´ì•¼ í•©ë‹ˆë‹¤.
#    - [í•´ê²° ëª©í‘œ]: `df_match`ì˜ `players` ì»¬ëŸ¼ì—ì„œ 'VI' ì±”í”¼ì–¸ì´ ì¥ì°©í•œ ëª¨ë“  `item_id`ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
# ----------------------------------------------------------------------------------------------------



